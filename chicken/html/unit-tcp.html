<html><head><title>CHICKEN User's Manual - Unit tcp</title></head><body>
<p> </p><a name='Unit tcp'><h1>Unit tcp</h1></a><p>This unit provides basic facilities for communicating over TCP sockets. The socket interface should be mostly compatible to the one found in PLT Scheme.</p><p>This unit uses the <tt>extras</tt> unit.</p><p>All errors related to failing network operations will raise a condition of kind <tt>(exn i/o network)</tt>.</p><a name='tcp-listen'><h2>tcp-listen</h2></a><pre>[procedure] (tcp-listen TCPPORT [BACKLOG [HOST]])</pre><p>Creates and returns a TCP listener object that listens for connections on <tt>TCPPORT</tt>, which should be an exact integer. <tt>BACKLOG</tt> specifies the number of maximally pending connections (and defaults to 4). If the optional argument <tt>HOST</tt> is given and not <tt>#f</tt>, then only incoming connections for the given host (or IP) are accepted.</p><a name='tcp-listener?'><h2>tcp-listener?</h2></a><pre>[procedure] (tcp-listener? X)</pre><p>Returns <tt>#t</tt> if <tt>X</tt> is a TCP listener object, or <tt>#f</tt> otherwise.</p><a name='tcp-close'><h2>tcp-close</h2></a><pre>[procedure] (tcp-close LISTENER)</pre><p>Reclaims any resources associated with <tt>LISTENER</tt>.</p><a name='tcp-accept'><h2>tcp-accept</h2></a><pre>[procedure] (tcp-accept LISTENER)</pre><p>Waits until a connection is established on the port on which <tt>LISTENER</tt> is listening and returns two values: an input- and output-port that can be used to communicate with the remote process. </p><p>Note: this operation and any I/O on the ports returned will not block other running threads.</p><a name='tcp-accept-ready?'><h2>tcp-accept-ready?</h2></a><pre>[procedure] (tcp-accept-ready? LISTENER)</pre><p>Returns <tt>#t</tt> if there are any connections pending on <tt>LISTENER</tt>, or <tt>#f</tt> otherwise.</p><a name='tcp-listener-port'><h2>tcp-listener-port</h2></a><pre>[procedure] (tcp-listener-port LISTENER)</pre><p>Returns the port number assigned to <tt>LISTENER</tt> (If you pass <tt>0</tt> to <tt>tcp-listen</tt>, then the system will choose a port-number for you).</p><a name='tcp-listener-fileno'><h2>tcp-listener-fileno</h2></a><pre>[procedure] (tcp-listener-port LISTENER)</pre><p>Returns the file-descriptor associated with <tt>LISTENER</tt>.</p><a name='tcp-connect'><h2>tcp-connect</h2></a><pre>[procedure] (tcp-connect HOSTNAME [TCPPORT])</pre><p>Establishes a client-side TCP connection to the machine with the name <tt>HOSTNAME</tt> (a string) at <tt>TCPPORT</tt> (an exact integer) and returns two values: an input- and output-port for communicating with the remote process.</p><p>Note: any I/O on the ports returned will not block other running threads.</p><a name='tcp-addresses'><h2>tcp-addresses</h2></a><pre>[procedure] (tcp-addresses PORT)</pre><p>Returns two values for the input- or output-port <tt>PORT</tt> (which should be a port returned by either <tt>tcp-accept</tt> or <tt>tcp-connect</tt>): the IP address of the local and the remote machine that are connected over the socket associated with <tt>PORT</tt>. The returned addresses are strings in <tt>XXX.XXX.XXX.XXX</tt> notation.</p><a name='tcp-port-numbers'><h2>tcp-port-numbers</h2></a><pre>[procedure] (tcp-port-numbers PORT)</pre><p>Returns two values for the input- or output-port <tt>PORT</tt> (which should be a port returned by either <tt>tcp-accept</tt> or <tt>tcp-connect</tt>): the TCP port numbers of the local and the remote machine that are connected over the socket associated with <tt>PORT</tt>.</p><a name='tcp-abandon-port'><h2>tcp-abandon-port</h2></a><pre>[procedure] (tcp-abandon-port PORT)</pre><p>Marks the socket port <tt>PORT</tt> as abandoned. This is mainly useful to close down a port without breaking the connection.</p><a name='tcp-buffer-size'><h2>tcp-buffer-size</h2></a><pre>[parameter] tcp-buffer-size</pre><p>Sets the size of the output buffer. By default no output-buffering for TCP output is done, but to improve performance by minimizing the number of TCP packets, buffering may be turned on by setting this parameter to an exact integer greater zero. A buffer size of zero or <tt>#f</tt> turns buffering off. The setting of this parameter takes effect at the time when the I/O ports for a particular socket are created, i.e. when <tt>tcp-connect</tt> or <tt>tcp-accept</tt> is called.</p><p>Note that since output is not immediately written to the associated socket, you may need to call <tt>flush-output</tt>, once you want the output to be transmitted. Closing the output port will flush automatically.</p><a name='Example'><h1>Example</h1></a><p>A very simple example follows. Say we have the two files <tt>client.scm</tt> and <tt>server.scm</tt>:</p><PRE>
<I><FONT COLOR="#B22222">; client.scm
</FONT></I>(declare (uses tcp))
(define-values (i o) (tcp-connect <B><FONT COLOR="#BC8F8F">&quot;localhost&quot;</FONT></B> 4242))
(write-line <B><FONT COLOR="#BC8F8F">&quot;Good Bye!&quot;</FONT></B> o)
(print (read-line i))
</PRE>
<PRE>
<I><FONT COLOR="#B22222">; server.scm
</FONT></I>(declare (uses tcp))
(<B><FONT COLOR="#A020F0">define</FONT></B> <B><FONT COLOR="#0000FF">l</FONT></B> (tcp-listen 4242))
(define-values (i o) (tcp-accept l))
(write-line <B><FONT COLOR="#BC8F8F">&quot;Hello!&quot;</FONT></B> o)
(print (read-line i))
(close-input-port i)
(close-output-port o)
</PRE>
<pre>% csc server.scm
% csc client.scm
% ./server &amp;
% ./client
Good Bye!
Hello!</pre><p>Previous: <a href='unit-utils.html' class='internal'>Unit utils</a></p><p>Next: <a href='unit-lolevel.html' class='internal'>Unit lolevel</a></p>
</body></html>