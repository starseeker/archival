<html><head><title>CHICKEN User's Manual - Data representation</title></head><body>
<p></p><a name='Data Representation'><h1>Data Representation</h1></a><p><em>Note: In all cases below, bits are numbered starting at 1 and beginning with the lowest-order bit.</em></p><p>There exist two different kinds of data objects in the CHICKEN system: immediate and non-immediate objects. Immediate objects are represented by a single machine word, which is usually of 32 bits length, or 64 bits on 64-bit architectures.   The immediate objects come in four different flavors:</p><p><strong>fixnums</strong>, that is, small exact integers, where bit 1 is set to 1. This gives fixnums a range of 31 bits for the actual numeric value (63 bits on 64-bit architectures).</p><p><strong>characters</strong>, where bits 1-4 are equal to <tt>C_CHARACTER_BITS</tt>. The Unicode code point of the character is encoded in bits 9 to 32.</p><p><strong>booleans</strong>, where bits 1-4 are equal to <tt>C_BOOLEAN_BITS</tt>. Bit 5 is one for #t and zero for #f.</p><p>other values: the empty list, the value of unbound identifiers, the undefined value (void), and end-of-file.  Bits 1-4 are equal to <tt>C_SPECIAL_BITS</tt>; bits 5 to 8 contain an identifying number for this type of object.  The following constants are defined: <tt>C_SCHEME_END_OF_LIST C_SCHEME_UNDEFINED C_SCHEME_UNBOUND C_SCHEME_END_OF_FILE</tt></p><p>Non-immediate objects are blocks of data represented by a pointer into the heap. The first word of the data block contains a header, which gives information about the type of the object. The header has the size of a machine word, usually 32 bits (64 bits on 64 bit architectures).</p><p>bits 1 to 24 contain the length of the data object, which is either the number of bytes in a string (or byte-vector) or the the number of elements for a vector or for a structure type.</p><p>bits 25 to 28 contain the type code of the object.</p><p>bits 29 to 32 contain miscellaneous flags used for garbage collection or internal data type dispatching. These flags are:</p><dl><dt>C_GC_FORWARDING_BIT</dt><dd>Flag used for forwarding garbage collected object pointers.</dd><dt>C_BYTEBLOCK_BIT</dt><dd>Flag that specifies whether this data object contains raw bytes (a string or byte-vector) or pointers to other data objects.</dd><dt>C_SPECIALBLOCK_BIT</dt><dd>Flag that specifies whether this object contains a <em>special</em> non-object pointer value in its first slot. An example for this kind of objects are closures, which are a vector-type object with the code-pointer as the first item.</dd><dt>C_8ALIGN_BIT</dt><dd>Flag that specifies whether the data area of this block should be aligned on an 8-byte boundary (floating-point numbers, for example).</dd></dl><p>The actual data follows immediately after the header. Note that block-addresses are always aligned to the native machine-word boundary. Scheme data objects map to blocks in the following manner:</p><p>pairs: vector-like object (type bits <tt>C_PAIR_TYPE</tt>), where the car and the cdr are contained in the first and second slots, respectively.</p><p>vectors: vector object (type bits <tt>C_VECTOR_TYPE</tt>).</p><p>strings: byte-vector object (type bits <tt>C_STRING_TYPE</tt>).</p><p>procedures: special vector object (type bits <tt>C_CLOSURE_TYPE</tt>). The first slot contains a pointer to a compiled C function. Any extra slots contain the free variables (since a flat closure representation is used).</p><p>flonum: a byte-vector object (type bits <tt>C_FLONUM_BITS</tt>). Slots one and two (or a single slot on 64 bit architectures) contain a 64-bit floating-point number, in the representation used by the host systems C compiler.</p><p>symbol: a vector object (type bits <tt>C_SYMBOL_TYPE</tt>). Slots one and two contain the toplevel variable value and the print-name (a string) of the symbol, respectively.</p><p>port: a special vector object (type bits <tt>C_PORT_TYPE</tt>). The first slot contains a pointer to a file- stream, if this is a file-pointer, or NULL if not. The other slots contain housekeeping data used for this port.</p><p>structure: a vector object (type bits <tt>C_STRUCTURE_TYPE</tt>). The first slot contains a symbol that specifies the kind of structure this record is an instance of. The other slots contain the actual record items.</p><p>pointer: a special vector object (type bits <tt>C_POINTER_TYPE</tt>). The single slot contains a machine pointer.</p><p>tagged pointer: similar to a pointer (type bits  <tt>C_TAGGED_POINTER_TYPE</tt>), but the object contains an additional slot with a tag (an arbitrary data object) that identifies the type of the pointer.</p><p>Data objects may be allocated outside of the garbage collected heap, as long as their layout follows the above mentioned scheme. But care has to be taken not to mutate these objects with heap-data (i.e. non-immediate objects), because this will confuse the garbage collector.</p><p>For more information see the header file <tt>chicken.h</tt>.</p><p>Previous: <a href='chicken-setup.html' class='internal'>chicken-setup</a></p><p>Next: <a href='bugs-and-limitations.html' class='internal'>Bugs and limitations</a></p>
</body></html>